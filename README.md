# a2proxy

Bash script which generates Apache2 reverse proxy virtual host configuration files, used in my dev lab.

## Deployment and configuration

Clone the repository and execute the following commands:

```bash
cp a2proxy.sh /usr/local/bin/a2proxy
cp dns2pihole.sh /usr/local/bin/dns2pihole
sudo chmod +x /usr/local/bin/{a2proxy,dns2pihole}
cp a2proxy.template.conf /etc/apache2/sites-available/
```

Thus `a2proxy` and `dns2pihole` will be available as shell commands system wide.

`a2proxy` is the main script within this repo. We will use it to generate Apache2 Virtual host configuration files, on the base of `a2proxy.template.conf`.

`dns2pihole` is optional, ti creates entries within [Pi-hole](https://pi-hole.net/)'s DNS table for the created Virtual hosts.

Once the files ar placed in their location review and tweak each of them. As follow

* `a2proxy` have settings section at the beginning, where you can configure the parameters of your test environment. At the end of the functions `create()` and `remove()` you can chain `dns2pihole`. The function `pm2help()` outputs some essential commands for [PM2](https://pm2.keymetrics.io/), you can remove it in case it is not interesting for your project.

* `dns2pihole` also have settings section at the beginning. It is designed to be called by `a2proxy` but also could be used alone.

* Within the leading settings section `a2proxy.template.conf` you can tweak the values of the variables `proxy_secret` and `proxy_cookie`. Don't touch the other variables - `a2proxy` will do that.

## Additional configuration files

The template file `a2proxy.template.conf` constrains a basic Reverse Proxy configuration that will serve well for the most of your projects. Currently it uses SSL/TLS and requires wildcard certificate. Im using one generated by Let's Encrypt. However some complex services require much complex Reverse Proxy configuration. Within the directory `a2-sites-available/` are provided tested example configuration for the following services:

* [code.example.com.conf](./a2-sites-available/code.example.com.conf) - configuration file for **Visual Studio Code Server**, proved by @LinuxServer.io as [docker image](https://docs.linuxserver.io/images/docker-code-server).

* [docs.example.com.conf](./a2-sites-available/docs.example.com.conf) - configuration file for **Only Office Document Server**, proved by @hub.docker.com as [docker image](https://hub.docker.com/r/onlyoffice/documentserver).

* [guacamole.example.com.conf](./a2-sites-available/guacamole.example.com.conf) - configuration file for **Apache Guacamole v.1.3**, [native installation](https://guacamole.apache.org/releases/).

* [link.example.com.conf](./a2-sites-available/link.example.com.conf) - configuration file for **TP-Link Router** within LAN.

* [pihole.example.com.conf](./a2-sites-available/pihole.example.com.conf) - configuration file for **Pi-hole**, proved by @hub.docker.com as [docker image](https://hub.docker.com/r/pihole/pihole).

* [plex.example.com.conf](./a2-sites-available/plex.example.com.conf) - configuration file for **Plex Media Server** - [references and installation guide](https://wiki.szs.space/wiki/Plex_Media_Server_on_Ubuntu_20.04).

* [pve.example.com.conf](./a2-sites-available/pve.example.com.conf) - configuration file for **Proxmox Virtual Environment** - [references and installation guide](https://wiki.szs.space/wiki/Proxmox_Reference_Manual).

* [wireshark.example.com.conf](./a2-sites-available/wireshark.example.com.conf) - configuration file for **WireShark**, proved by @LinuxServer.io as [docker image](https://docs.linuxserver.io/images/docker-wireshark).

Within the directory `a2-confs/` as a reference is provided my current Apache2 base configuration.

## Usage

```bash
$ a2proxy
Please run as root (use sudo).
```
```bash
$ sudo a2proxy 
a2proxy sub-domain 8080 [127.0.0.1]
a2proxy sub-domain remove
```
```bash
$ sudo a2proxy guacamole 8081
Enabling site guacamole.example.com.
To activate the new configuration, you need to run:
  systemctl reload apache2
Syntax OK
Enabled: https://guacamole.example.com                    # Output from dns2pihole.sh
The entry '172.16.1.151 guacamole.szs.space' is created.  # Output from dns2pihole.sh
```

